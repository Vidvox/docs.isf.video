<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ISF Multi-Pass and Persistent Buffer Reference | ISF Documenation</title>
    <meta name="description" content="Interactive Shader Format is a file format used to describe GLSL shaders for real-time image filtering and generation.">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500">
    
    <link rel="preload" href="/assets/css/0.styles.e46be848.css" as="style"><link rel="preload" href="/assets/js/app.6d8aac83.js" as="script"><link rel="preload" href="/assets/js/20.cd0ef636.js" as="script"><link rel="prefetch" href="/assets/js/10.c8f3fa1e.js"><link rel="prefetch" href="/assets/js/11.e5e59264.js"><link rel="prefetch" href="/assets/js/12.e918779f.js"><link rel="prefetch" href="/assets/js/13.c860494a.js"><link rel="prefetch" href="/assets/js/14.dbc4c4b9.js"><link rel="prefetch" href="/assets/js/15.062b0eec.js"><link rel="prefetch" href="/assets/js/16.e349a769.js"><link rel="prefetch" href="/assets/js/17.5ed081e1.js"><link rel="prefetch" href="/assets/js/18.4a64789d.js"><link rel="prefetch" href="/assets/js/19.ebafee6d.js"><link rel="prefetch" href="/assets/js/2.6d720a38.js"><link rel="prefetch" href="/assets/js/21.36ff03de.js"><link rel="prefetch" href="/assets/js/22.3573e69c.js"><link rel="prefetch" href="/assets/js/23.9a215b3a.js"><link rel="prefetch" href="/assets/js/3.b812cbbc.js"><link rel="prefetch" href="/assets/js/4.8c133ff6.js"><link rel="prefetch" href="/assets/js/5.c2d76b22.js"><link rel="prefetch" href="/assets/js/6.e95f5c9b.js"><link rel="prefetch" href="/assets/js/7.15405d7b.js"><link rel="prefetch" href="/assets/js/8.55f275fb.js"><link rel="prefetch" href="/assets/js/9.34e860c3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e46be848.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ISF Documenation</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/using_isf.html" class="nav-link">Using ISF</a></div><div class="nav-item"><a href="/quickstart.html" class="nav-link">Quickstart</a></div><div class="nav-item"><a href="/primer/" class="nav-link">Primer</a></div><div class="nav-item"><a href="/ref/" class="nav-link router-link-active">Reference</a></div><div class="nav-item"><a href="https://isf.video" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ISF Homepage
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/using_isf.html" class="nav-link">Using ISF</a></div><div class="nav-item"><a href="/quickstart.html" class="nav-link">Quickstart</a></div><div class="nav-item"><a href="/primer/" class="nav-link">Primer</a></div><div class="nav-item"><a href="/ref/" class="nav-link router-link-active">Reference</a></div><div class="nav-item"><a href="https://isf.video" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ISF Homepage
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/ref/ref_variables.html" class="sidebar-link">Automatically Created Variables, Uniforms and Constants</a></li><li><a href="/ref/ref_functions.html" class="sidebar-link">Built-In Functions</a></li><li><a href="/ref/ref_multipass.html" class="active sidebar-link">Multi-Pass Shaders and Persistent Buffers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ref/ref_multipass.html#persistent-buffers" class="sidebar-link">Persistent Buffers</a></li><li class="sidebar-sub-header"><a href="/ref/ref_multipass.html#multi-pass-shaders" class="sidebar-link">Multi-Pass Shaders</a></li></ul></li><li><a href="/ref/ref_json.html" class="sidebar-link">ISF JSON Attributes</a></li><li><a href="/ref/ref_converting.html" class="sidebar-link">Converting Non-ISF GLSL shaders to ISF</a></li><li><a href="/ref/ref_changes.html" class="sidebar-link">Change Log</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="isf-multi-pass-and-persistent-buffer-reference"><a href="#isf-multi-pass-and-persistent-buffer-reference" aria-hidden="true" class="header-anchor">#</a> ISF Multi-Pass and Persistent Buffer Reference</h1> <p>Two extremely powerful concepts that ISF adds on to GLSL are the ability to retain image information between render passes (persistent buffers) and creating compound shaders that have multiple rendering stages (multi-pass shaders) at potentially varying sizes.</p> <h2 id="persistent-buffers"><a href="#persistent-buffers" aria-hidden="true" class="header-anchor">#</a> Persistent Buffers</h2> <p>ISF files can define persistent buffers.  These buffers are images (GL textures) that stay with the ISF file for as long as it exists. This is useful if you want to &quot;build up&quot; an image over time- you can repeatedly query and update the contents of persistent buffers by rendering into them- or if you want to perform calculations across the entire image, storing the results somewhere for later evaluation. Further details on exactly how to do this are in the full <a href="https://github.com/mrRay/ISF_Spec/" target="_blank" rel="noopener noreferrer">ISF Specification Page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>For each buffer that you wish to retain between passes, the <code>PERSISTENT</code> can be set to <code>true</code>.  If you wish to have the value stored as a 32-bit floating point value the additional <code>FLOAT</code> attribute can be included and set to <code>true</code>.  Using 32-bit textures will use up more memory, but in some cases can be extremely useful.</p> <div class="language- extra-class"><pre class="language-text"><code>/*{
	&quot;DESCRIPTION&quot;: &quot;demonstrates the use of a persistent buffer to create a motion-blur type effect. also demonstrates the simplest use of steps: a one-step rendering pass&quot;,
	&quot;CREDIT&quot;: &quot;by zoidberg&quot;,
	&quot;ISFVSN&quot;: &quot;2.0&quot;,
	&quot;CATEGORIES&quot;: [
		&quot;TEST-GLSL FX&quot;
	],
	&quot;INPUTS&quot;: [
		{
			&quot;NAME&quot;: &quot;inputImage&quot;,
			&quot;TYPE&quot;: &quot;image&quot;
		},
		{
			&quot;NAME&quot;: &quot;blurAmount&quot;,
			&quot;TYPE&quot;: &quot;float&quot;
		}
	],
	&quot;PASSES&quot;: [
		{
			&quot;TARGET&quot;: &quot;bufferVariableNameA&quot;,
			&quot;PERSISTENT&quot;: true,
			&quot;FLOAT&quot;: true
		}
	]
	
}*/

void main()
{
	vec4		freshPixel = IMG_THIS_PIXEL(inputImage);
	vec4		stalePixel = IMG_THIS_PIXEL(bufferVariableNameA);
	gl_FragColor = mix(freshPixel,stalePixel,blurAmount);
}
</code></pre></div><h2 id="multi-pass-shaders"><a href="#multi-pass-shaders" aria-hidden="true" class="header-anchor">#</a> Multi-Pass Shaders</h2> <p>The ISF file format defines the ability to execute a shader multiple times in the process of rendering a frame for output- each time the shader's executed (each pass), the uniform int variable <code>PASSINDEX</code> is incremented. Details on how to accomplish this are described below in the spec, but the basic process involves adding an array of dicts to the <code>PASSES</code> key in your top-level JSON dict. Each dict in the <code>PASSES</code> array describes a different rendering pass- the ISF host will automatically create buffers to render into, and those buffers (and therefore the results of those rendering passes) can be accessed like any other buffer/input image/imported image (you can render to a texture in one pass, and then read that texture back in and render something else in another pass).  The dicts in <code>PASSES</code> recognize a number of different keys to specify different properties of the rendering passes- more details are in the spec below.</p> <div class="language- extra-class"><pre class="language-text"><code>/*{
	&quot;DESCRIPTION&quot;: &quot;demonstrates the use of two-pass rendering- the first pass renders to a persistent buffer which is substantially smaller than the res of the image being drawn.  the second pass renders at the default requested size and scales up the image from the first pass&quot;,
	&quot;CREDIT&quot;: &quot;by zoidberg&quot;,
	&quot;ISFVSN&quot;: &quot;2.0&quot;,
	&quot;CATEGORIES&quot;: [
		&quot;TEST-GLSL FX&quot;
	],
	&quot;INPUTS&quot;: [
		{
			&quot;NAME&quot;: &quot;inputImage&quot;,
			&quot;TYPE&quot;: &quot;image&quot;
		}
	],
	&quot;PASSES&quot;: [
		{
			&quot;TARGET&quot;:&quot;bufferVariableNameA&quot;,
			&quot;PERSISTENT&quot;: true,
			&quot;WIDTH&quot;: &quot;$WIDTH/16.0&quot;,
			&quot;HEIGHT&quot;: &quot;$HEIGHT/16.0&quot;
		},
		{
		
		}
	]
	
}*/

void main()
{
	//	first pass: read the &quot;inputImage&quot;- remember, we're drawing to the persistent buffer &quot;bufferVariableNameA&quot; on the first pass
	if (PASSINDEX == 0)	{
		gl_FragColor = IMG_THIS_NORM_PIXEL(inputImage);
	}
	//	second pass: read from &quot;bufferVariableNameA&quot;.  output looks chunky and low-res.
	else if (PASSINDEX == 1)	{
		gl_FragColor = IMG_THIS_NORM_PIXEL(bufferVariableNameA);
	}
}
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/ref/ref_functions.html" class="prev">
          Built-In Functions
        </a></span> <span class="next"><a href="/ref/ref_json.html">
          ISF JSON Attributes
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/20.cd0ef636.js" defer></script><script src="/assets/js/app.6d8aac83.js" defer></script>
  </body>
</html>
